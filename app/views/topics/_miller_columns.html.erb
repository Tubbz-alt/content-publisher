<% def unroll(topic) %>
  <li>
    <div class="govuk-checkboxes__item">
      <%= tag.input type: "checkbox",
                    id: "topic-#{topic.content_id}",
                    class: "govuk-checkboxes__input",
                    name: "topics[]",
                    value: topic.content_id,
                    checked: @topics.include?(topic),
                    data: {
                        gtm: "choose-topics",
                        "gtm-value": topic.title
                    } %>

      <%= tag.label for: "topic-#{topic.content_id}", class:"govuk-label govuk-checkboxes__label" do %>
        <%= topic.title %>
      <% end %>
    </div>

    <% if topic.children.any? %>
      <ul class="govuk-list">
        <% topic.children.each do |child_topic| %>
          <% unroll(child_topic) %>
        <% end %>
      </ul>
    <% end %>
  </li>
<% end %>

<div class="app-js-only">
  <%= render "components/autocomplete", {
    id: "topics-autocomplete",
    name: "topics-autocomplete",
    label: {
      text: "Search topics",
      bold: true
    },
    type: "topics",
    search: true
  } %>
</div>

<miller-columns id="miller-columns" class="miller-columns" for="taxonomy" selected="selected-items">
  <ul id="taxonomy" class="govuk-list">
    <% Topic.govuk_homepage(@edition.document_topics.index).children.each do |topic| %>
      <% unroll(topic) %>
    <% end %>
  </ul>
</miller-columns>
