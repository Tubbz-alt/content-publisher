<div class="app-side">
  <div class="app-side__actions">
    <%
      def delete_draft_link(extra_class = [])
        link_to("Delete draft",
                delete_draft_path(@edition.document),
                class: %w(govuk-link app-link--destructive) + Array(extra_class),
                data: { gtm: "delete-draft" })
      end
    %>
    <% if @edition.status.published_but_needs_2i? %>
      <%= form_tag approve_document_path(@edition.document) do %>
        <%= render "govuk_publishing_components/components/button", text: "Approve" %>
      <% end %>

      <%= form_tag create_edition_path(@edition.document) do %>
        <%= render "govuk_publishing_components/components/button",
          text: "Create new edition",
          secondary: true,
          data_attributes: { gtm: "create-new-edition" } %>
      <% end %>

      <%= link_to "Withdraw", withdraw_path(@edition.document), class: "govuk-link govuk-link--no-visited-state" %>
      <%= link_to "Remove", remove_path(@edition.document), class: "govuk-link app-link--destructive app-link--right" %>
    <% elsif @edition.status.published? %>
      <%= form_tag create_edition_path(@edition.document) do %>
        <%= render "govuk_publishing_components/components/button", text: "Create new edition", data_attributes: { gtm: "create-new-edition" } %>
      <% end %>
      <%= link_to "Withdraw", withdraw_path(@edition.document), class: "govuk-link govuk-link--no-visited-state" %>
      <%= link_to "Remove", remove_path(@edition.document), class: "govuk-link app-link--destructive app-link--right" %>
    <% elsif @edition.status.removed? %>
      <%= form_tag create_edition_path(@edition.document) do %>
        <%= render "govuk_publishing_components/components/button", text: "Create new edition", data_attributes: { gtm: "create-new-edition" } %>
      <% end %>
    <% elsif @edition.status.submitted_for_review? %>
      <%= render "govuk_publishing_components/components/button",
                 text: "Publish",
                 href: publish_confirmation_path(@edition.document) %>
      <%= render "govuk_publishing_components/components/button",
                 text: "Preview",
                 href: preview_document_path(@edition.document),
                 secondary: true %>

      <%= delete_draft_link("app-link--right") %>
    <% elsif !@edition.revision_synced? %>
      <%= form_tag create_preview_path(@edition.document) do %>
        <%= render "govuk_publishing_components/components/button", text: "Preview" %>
      <% end %>

      <%= delete_draft_link %>
    <% elsif @edition.withdrawn? %>
      <%= render "govuk_publishing_components/components/button",
                 text: "Undo withdrawal",
                 data_attributes: { gtm: "undo-withdraw" },
                 href: unwithdraw_path(@document) %>
    <% elsif @edition.scheduled? %>
      <%= form_tag create_preview_path(@edition.document) do %>
        <%= render "govuk_publishing_components/components/button", text: "Preview" %>
      <% end %>
      <%= delete_draft_link %>
    <% else %>
      <%= form_tag submit_document_for_2i_path(@edition.document) do %>
        <%= render "govuk_publishing_components/components/button", text: "Submit for 2i review" %>
      <% end %>

      <%= render "govuk_publishing_components/components/button", text: "Preview", href: preview_document_path(@edition.document), secondary: true %>

      <% if @edition.scheduled_publishing_datetime.present? && !@edition.scheduled? %>
        <%= link_to "Schedule", scheduling_confirmation_path(@edition.document), class: "govuk-link govuk-link--no-visited-state" %>
      <% else %>
        <%= link_to "Publish", publish_confirmation_path(@edition.document), class: "govuk-link govuk-link--no-visited-state" %>
      <% end %>
      <%= delete_draft_link("app-link--right") %>
    <% end %>

    <% if @edition.document.live_edition %>
      <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible" />
      <%= link_to "View published edition on GOV.UK", EditionUrl.new(@edition.document.live_edition).public_url, class: "govuk-link govuk-link--no-visited-state" %>
    <% end %>

    <% if (@edition.editable? || @edition.scheduled?) && current_user.has_permission?(User::PRE_RELEASE_FEATURES_PERMISSION) %>
      <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible" />
      <%= render "documents/show/scheduling_form" %>
    <% end %>
  </div>
</div>
