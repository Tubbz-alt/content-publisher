<% document_contents_guidance = capture do %>
  <%= I18n.exists?("document_types.#{edition.document_type.id}.fields.#{field.id}.guidance") ? render_govspeak(t("document_types.#{edition.document_type.id}.fields.#{field.id}.guidance.body_govspeak")) : nil %>
  <h3 class="govuk-heading-s"><%= t("content.edit.fields.govspeak.title") %></h3>
  <p class="govuk-body">
    <%= link_to t("content.edit.fields.govspeak.guidance"), "https://www.gov.uk/guidance/how-to-publish-on-gov-uk/markdown", class: "govuk-link", target: "_blank" %>
  </p>
  <%= render "components/markdown_guidance" %>
<% end %>

<%
  field_contextual_guidance = {
    id: field.id,
    html_for: "#{field.id}-field"
  }
  if I18n.exists?("document_types.#{edition.document_type.id}.fields.#{field.id}.guidance")
    field_contextual_guidance.merge!({
      title: t("document_types.#{edition.document_type.id}.fields.#{field.id}.guidance.title"),
      content: document_contents_guidance,
      guidance_id: "#{field.id}-guidance"
    })
  end
%>

<%= render "govuk_publishing_components/components/contextual_guidance", field_contextual_guidance do %>
  <%= render "components/markdown_editor", {
    label: {
      text: field.label,
      bold: true
    },
    textarea: {
      data: {
        gramm: "false", # Disables grammerly plugin for markdown editor
        gtm: "#{field.id}-input",
        "gtm-copy-paste-tracking": true,
      },
      id: "#{field.id}-field",
      name: "revision[contents][#{field.id}]",
      value: revision.contents[field.id],
      rows: 20,
      spellcheck: "false",
      describedby: "#{field.id}-guidance"
    },
    govspeak_path: govspeak_preview_path(edition.document),
    edition: edition,
    error_items: issues&.items_for(field.id.to_sym),
    paste_html_to_govspeak: true
  } %>
<% end %>
