<% content_for :title, t("contacts.search.title") %>

<%
  contact_options = @contacts_by_organisation.flat_map do |org|
    org["contacts"].map do |contact|
      [contact['title'], contact["content_id"], {"data-hint": org['name']}]
    end
  end
%>

<%= form_tag(
  search_contacts_path(@edition.document),
  data: {
    modal_action: "insert",
    gtm: "insert-contact-embed"
  },
) do %>
  <%= render "components/autocomplete", {
    name: "contact_id",
    label: {
      text: t("contacts.search.label"),
      bold: true
    },
    hint: t("contacts.search.hint_text"),
    id: "contact-id",
    select: {
      options: [""] + contact_options,
    },
    type: "with-hint-on-options",
    search: true,
  } %>

  <%= render "govuk_publishing_components/components/button", {
    text: "Insert contact",
    data_attributes: {
      "modal-action": "insert",
      gtm: "insert-contact"
    },
    margin_bottom: true
  } %>

  <%= tag.p class: "govuk-body" do %>
    <%= link_to t("contacts.search.edit_or_add_contact"), Plek.new.external_url_for("whitehall") + "/government/admin/organisations/", class: "govuk-link", target: "_blank" %>
  <% end %>
<% end %>
