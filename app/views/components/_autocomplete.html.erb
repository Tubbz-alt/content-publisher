<%
  id ||= "autocomplete-#{SecureRandom.hex(4)}"
  options ||= []
  selected_options ||= []
  multiple ||= nil
  type ||= nil
  size ||= nil
  error_id = "error-#{SecureRandom.hex(4)}"
  error_items ||= []
  hint ||= nil
  width ||= nil
  aria = error_id if error_items.any?

  root_classes = %w(app-c-autocomplete govuk-form-group)
  root_classes << "app-c-autocomplete--#{width}" if width
  root_classes << "govuk-form-group--error" if error_items.any?
%>

<%= tag.div class: root_classes, data: { module: "autocomplete", "autocomplete-type": type } do %>
  <%= tag.fieldset class: "govuk-fieldset", "aria-describedby": aria do %>
    <%= render "govuk_publishing_components/components/label", {
      html_for: id
    }.merge(label.symbolize_keys) %>

    <% if error_items.any? %>
      <%= render "govuk_publishing_components/components/error_message", {
        id: error_id,
        text: raw(error_items.map { |item| item[:text] }.join("<br/>"))
      } %>
    <% end %>

    <% if options.any? %>
      <%= tag.span "To select multiple items in a list, hold down Ctrl (PC) or Command (Mac) key.", class: "govuk-hint app-c-autocomplete__multiselect-instructions" if multiple %>

      <%= tag.span hint, class: "govuk-hint" if hint %>

      <%= select_tag name,
        options_for_select(options, selected_options),
        id: id,
        class: "govuk-select",
        size: size,
        multiple: multiple
      %>
    <% else %>
      <%= tag.p "No options available", class: "govuk-hint" %>
    <% end %>
  <% end %>
<% end %>
